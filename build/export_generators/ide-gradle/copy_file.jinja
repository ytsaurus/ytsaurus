{%- set copies = target.target_commands|selectattr("macro", "eq", "copy_file") -%}
{%- if copies|length -%}
{%-     for copy in copies -%}
{%-         set src = copy.args[0] -%}
{%-         set dst = copy.args[1] -%}
{%-         set src_split = rsplit(src, "/", 2) -%}
{%-         set src_path = src_split[0] -%}
{%-         set src_name = src_split[1] -%}
{%-         set dst_split = rsplit(dst, "/", 2) -%}
{%-         set dst_path = dst_split[0] -%}
{%-         set dst_name = dst_split[1] %}

val codegen{{ copy['_object_index'] }} = tasks.register<Copy>("copy{{ copy['_object_index'] }}") {
    from({{ PatchRoots(src_path) }}) {
        include("{{ src_name }}")
    }
    into({{ PatchRoots(dst_path) }})
{%-         if src_name != dst_name %}
    rename("{{ src_name }}", "{{ dst_name }}")
}
{%          endif -%}
{%-     endfor -%}
{%- endif -%}
