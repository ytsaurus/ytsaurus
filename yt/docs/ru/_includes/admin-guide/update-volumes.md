# Обновление томов в сервисах {{product-name}}

В этой статье описано, как изменить настройки томов для сервисов {{product-name}}, запущенных в Kubernetes.

## Важные особенности {#note}

При обновлении томов учитывайте следующее:

1.  **Оператор не применяет обновления автоматически.** Он не отслеживает изменения в конфигурации томов, поэтому изменение спецификации ресурса само по себе не запустит обновление.

2.  **Persistent Volume Claims (PVC) привязаны к подам.** Даже если удалить поды или StatefulSet, старые PVC останутся на месте. Они помешают применить новые настройки томов.

{% note warning %}

Описанные ниже действия приведут к потере данных на обновляемых томах, так как тома будут пересозданы заново. Будьте осторожны.

{% endnote %}

## Порядок действий {#steps}

Чтобы обновить настройки томов, выполните следующие шаги:

### Шаг 1. Отключите оператор {#disable-operator}

В спецификации ресурса {{product-name}} установите значение `false` для поля `isManaged`. Так вы остановите оператор, чтобы он не мешал вносить изменения вручную.

```yaml
spec:
  isManaged: false
```

Примените это изменение в кластере.

### Шаг 2. Удалите StatefulSet {#delete-statefulset}

Удалите StatefulSet того сервиса, тома которого вы обновляете:

```bash
kubectl delete statefulset <statefulset-name> -n <namespace>
```

### Шаг 3. Удалите Persistent Volume Claims {#delete-pvc}

Удалите PVC, связанные с подами:

```bash
kubectl delete pvc <pvc-name> -n <namespace>
```

Если у StatefulSet несколько реплик, удалите PVC для каждой из них. Найти нужные PVC можно командой:

```bash
kubectl get pvc -n <namespace>
```

### Шаг 4. Включите оператор {#enable-operator}

Верните значение `true` для поля `isManaged` в спецификации ресурса {{product-name}}:

```yaml
spec:
  isManaged: true
```

Примените изменение. Теперь оператор пересоздаст StatefulSet и PVC уже с новыми настройками томов.

## Пример: увеличение места для логов планировщика {#example}

Частая задача при работе с томами &mdash; увеличить место под логи. Допустим, нужно расширить хранилище логов для планировщиков с 10 ГБ до 50 ГБ.

1. Укажите новый размер тома в спецификации ресурса {{product-name}}:

```yaml
spec:
  schedulers:
    volumeClaimTemplates:
      - spec:
          resources:
            requests:
              storage: 50Gi  # увеличили с 10Gi
```

2. Выполните описанные выше шаги: установите `isManaged: false`, удалите StatefulSet и PVC, затем верните `isManaged: true`.

{% note warning %}

В результате этой операции **текущие логи будут потеряны**, так как старые PVC удаляются и создаются новые. Если логи нужно сохранить, сделайте резервную копию до начала обновления.

{% endnote %}