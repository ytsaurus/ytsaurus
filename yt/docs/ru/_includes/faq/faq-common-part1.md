#### **Q: Как добавить колонку в таблицу {{product-name}}?**

**A:** Необходимо получить текущую схему таблицы:

`yt get //home/maps-nmaps/production/pedestrian/address_tasks/@schema --format '<format=text>yson'`

И заменить схему на новую:
```bash
yt alter-table //home/maps-nmaps/testing/pedestrian/address_tasks --schema '<"unique_keys"=%false;"strict"=%true;>[{"name"="timestamp";"required"=%false;"type"="uint64";"sort_order"="ascending";};{"name"="lon";"required"=%false;"type"="double";};{"name"="lat";"required"=%false;"type"="double";};{"name"="buildingId";"required"=%false;"type"="string";};{"name"="taskId";"required"=%false;"type"="string";};{"name"="pedestrianType";"required"=%false;"type"="string";};{"name"="buildingPerimeter";"required"=%false;"type"="double";};{"name"="buildingShape";"required"=%false;"type"="string";};]'
```

В YQL можно использовать выражение `UNION ALL` для объединения новых данных с новой колонкой и старых данных из таблицы.

------
#### **Q: Получаю ошибку при попытке изменить схему таблицы - Changing «strict» from «false» to «true» is not allowed. Что делать?**

**A:** Нельзя поменять схему у непустой таблицы со слабой на строгую, так как для валидации подобного действия необходимо прочитать всю таблицу, чтобы убедиться, что данные соответствуют новой схеме. Проще всего создать новую таблицу и перезаписать данные из старой через read + write или запустив операцию [Merge](../../user-guide/data-processing/operations/merge.md).

------
#### **Q: Как авторизоваться при работе с YT из консоли?**

**A:** Необходимо сохранить токен нужного пользователя в файл `~/.yt/token`.

------
#### **Q: Можно ли уменьшить коэффициент репликации у временных таблиц в native C++ wrapper?**

**A:** Нет, в wrapper такая возможность не предусмотрена.

------
#### **Q: При использовании python wrapper возникает ошибка «ImportError: Bad magic number in ./modules/yt/__init__.pyc». Что делать?**

**A:** Такая ошибка возникает при несоответствии версии python у клиента, где запускается скрипт, и на кластере. Используйте для запуска ту же версию python, что и на кластере. Определить текущую версию можно так:

```bash
yt vanilla --tasks '{master = {job_count = 1; command = "python --version >&2"}}'
Python 2.7.3
```

Версия python может отличаться на разных узлах кластера. Надёжнее всего использовать свой [образ ФС](../../user-guide/data-processing/layers/layer-paths.md) для запуска джобов.

------
#### **Q: Каковы накладные расходы при чтении небольших диапазонов в таблицах и при чтении небольших таблиц?**

**A:** Небольшие диапазоны не создают накладных расходов, с диска читаются только релевантные блоки. При этом все чтения статических таблиц требуют запроса метаданных на мастер-сервере. Общение с мастер-сервером в данном случае является узким местом. В этом случае стоит читать статические таблицы меньшим числом запросов (более крупными частями), минимизировать нагрузку на мастер-сервер. Или перестроить свой процесс и читать из динамических таблиц.

------
#### **Q: Можно ли эффективно организовать хранение байтовых чисел (hex) в ключах вместо строк?**

**A:** Можно при использовании формата [YSON](../../user-guide/storage/formats.md#yson) или [JSON](../../user-guide/storage/formats.md#json).

------
#### **Q: Каковы уровни логирования в консольном клиенте и как они задаются?**

**A:** Уровни логирования в консольном клиенте задаются через переменную окружения `YT_LOG_LEVEL`, по умолчанию принято значение `INFO`. Изменить уровень логирования можно командой `export YT_LOG_LEVEL=WARNING`. Доступны следующие уровни логирования:

- `INFO` — выводится прогресс выполнения операции и другая полезная информация;
- `WARNING` — выводятся предупреждения. Например, не удалось выполнить запрос, и он отправляется повторно, или входная таблица операции пуста. Подобные ошибки не критичны, и клиент может продолжать успешно работать;
- `ERROR` — все ошибки, после которых клиент не может продолжить работу. Подобные ошибки приводят к исключению (Exception). Исключение обрабатывается, после чего клиент аварийно завершает работу с ненулевым кодом возврата.

{% if audience == "internal" %}

------
#### **Q: Как устроена очистка временных данных на кластерах?**

**A:** На большинстве кластеров {{product-name}} регулярно — раз в день или чаще — запускается скрипт очистки `//tmp`. Скрипт находит и удаляет давно не используемые или расходующие определённую часть квоты аккаунта `tmp` данные. Подробное описание процесса очистки содержится в разделе [Системные процессы](../../user-guide/storage/regular-system-processes.md). Пользователям необходимо учитывать наличие регулярной очистки при записи данных в `//tmp`.
{% endif %}

------
#### **Q: При чтении с помощью команды read небольшой таблицы клиент повисает при перезапросах. В чем может быть дело?**

**A:** Одна из возможных частых причин — слишком большое число (мелких) чанков в таблице. Следует запустить операцию [Merge](../../user-guide/data-processing/operations/merge.md), указав опцию `--spec '{force_transform=true}'`. При появлении таких таблиц в результате работы операций консольный клиент выдает предупреждение, содержащее, помимо прочего, команду, которую можно выполнить для укрупнения чанков таблицы. Также можно указать опцию `auto_merge_output={action=merge}`, в этом случае слияние будет выполняться автоматически.

------
#### **Q: Операция завершилась с ошибкой «Account "tmp" is over disk space (или chunk) limit», в чем дело?**

**A:** На кластере закончилось место для хранения временных данных (аккаунт tmp), либо чанков в этом аккаунте стало слишком много. К данному аккаунту имеют доступ все пользователи кластера, так что возможно его переполнение. Данное обстоятельство необходимо учитывать и, если переполнение квоты tmp критично для ваших процессов, то для временных данных следует использовать другую директорию в собственном аккаунте. Некоторые API используют `//tmp` как путь по умолчанию для хранения различных временных данных. В этом случае следует перенастроить их, чтобы использовались поддиректории внутри директории вашего проекта.

------
#### **Q: Операция упала с ошибкой «Account "intermediate" is over disk space (или chunk) limit», в чем дело?**

**A:** На кластере закончилось место для хранения промежуточных данных операций (аккаунт `intermediate`), либо чанков в этом аккаунте стало слишком много.
Если вы не указывали `intermediate_data_account` (смотрите раздел [Настройки операций](../../user-guide/data-processing/operations/operations-options.md), [Sort](../../user-guide/data-processing/operations/sort.md), [MapReduce](../../user-guide/data-processing/operations/mapreduce.md)). Это значит, что вы делите данный аккаунт со всеми. Чтобы избежать этой проблемы, укажите `intermediate_data_account`.

------
#### **Q: Является ли чтение таблицы (или файла) в {{product-name}} консистентной операцией? Что будет, если читать таблицу и одновременно с этим её удалить?**

**A:** С одной стороны, является, то есть если операция чтения завершится успешно, то будут прочитаны ровно те данные, которые были в таблице или файле в момент запуска операции. С другой стороны, чтение может оборваться, если таблицу в это время удалить. Чтобы избежать последнего, необходимо создать транзакцию и взять в ней snapshot-lock на таблицу или файл. При использовании python API, в том числе python CLI и включенных retry при чтении, данная блокировка берется автоматически.

------
#### **Q: При запуске клиента получаю ошибку "Cannot determine backend type: either driver config or proxy url should be specified". Что делать?**

**A:** Проверьте, указана ли переменная окружения `YT_PROXY=<cluster-name>`.

------

#### **Q: Что делать, если запрос Python обёртки падает с "gaierror(-2, 'Name or service not known')"?**

**A:** Если возникла ошибка вида:
`has failed with error <class 'yt.packages.requests.exceptions.ConnectionError'>, message: '('Connection aborted.', gaierror(-2, 'Name or service not known'))'`,

Ошибка «Name or service not known» - это ошибка DNS, сообщающая о том, что запрошенная DNS запись не была найдена. Как правило это означает, что python-клиент попытался порезолвить адрес кластера или одного из его хостов и ему не удалось это сделать.
