# Общие сведения

В данном разделе собрана информация о системе контроля доступа к таблицам и другим узлам [Кипариса](../../../user-guide/storage/cypress.md) (пользователям, группам, аккаунтам, чанкам, транзакциям и т. д.).

Любой пользовательский запрос проходит через прокси, которые [**аутентифицируют**](https://{{lang}}.wikipedia.org/wiki/Authentication) пользователя, то есть проверяют его подлинность. На основе содержащегося в запросе токена, полученного с помощью протокола [OAuth](https://{{lang}}.wikipedia.org/wiki/OAuth), прокси определяет имя пользователя, инициировавшего запрос. Если токен в запросе не указан, то считается, что запрос задан от пользователя `guest`. После прохождения аутентификации, на последующих этапах обработки пользовательского запроса токен не используется. Подробнее о токенах можно прочитать в разделе [Аутентификация](../../../user-guide/storage/auth.md).

**Авторизацией** (выдачей разрешений) занимается мастер-сервер Кипариса. Решение о предоставлении или отказе в доступе зависит от:

1. Вида доступа (чтение, запись и т.д.);
2. Пользователя, инициировавшего запрос;
3. Объекта, к которому запрашивается доступ.

В случае отказа в праве доступа формируется сообщение в котором указаны детали: имя пользователя, которому отказано в доступе, объект, к которому запрашивался доступ, и тип доступа.

Если от прокси приходит запрос, помеченный именем несуществующего пользователя, то мастер-сервер вернёт ошибку `No such user`. Такая ситуация потенциально возможна, поскольку получение токена и регистрация пользователя в системе — два действия, выполняемые на различных сервисах (получение токена происходит с помощью сервиса OAuth, а регистрация — на мастер-сервере {{product-name}}).

В системе {{product-name}} поддерживаются списки **пользователей** и **групп**. Обобщенно пользователи и группы называются **субъектами**. Членами групп могут быть произвольные субъекты: как пользователи, так и другие группы. Система гарантирует, что отношение «вхождение в группу» не содержит циклов. При авторизации решения принимаются на основе транзитивного замыкания. Таким образом, пользователь `A` может быть членом группы `C` как напрямую (входить непосредственно в состав группы `С`), так и косвенно (`A` входит в группу `B`, а группа `B` — в группу `C`).

У каждого объекта в системе {{product-name}} существует список контроля доступа (**Access Control List** или **ACL**). Данный список хранится в атрибуте `@acl` объекта и состоит из отдельных записей (**Access Control Entry** или **ACE**), где каждая запись содержит перечень субъектов, тип доступа и ряд других параметров, приведённых в таблице раздела [Авторизация](../../../user-guide/storage/access-control.md#authorization). Подробнее читайте в секции [Как правильно использовать ACL](#acl_usage).

## Пользователи, группы { #users_groups }

В Кипарисе хранятся:

* Список всех зарегистрированных пользователей. Список хранится по адресу `//sys/users` и представляет собой узел типа `user_map`.
* Список всех зарегистрированных групп. Хранится по адресу `//sys/groups` и представляет собой узел типа `group_map`.

{% note warning "Внимание" %}

Каждый пользователь и группа определяется уникальным именем. При этом пользователи и группы располагаются в одном пространстве имён, то есть имена пользователей и групп не могут совпадать.

{% endnote %}

#### Как посмотреть списки пользователей и групп

{% list tabs %}

- Через веб-интерфейс

  - Чтобы просмотреть список пользователей, на боковой панели перейдите в раздел **Users** или введите в адресной строке браузера: `{{cluster-ui}}/users`
  - Чтобы просмотреть список групп, перейдите в раздел **Groups** или введите в адресной строке браузера: `{{cluster-ui}}/groups`

- Через CLI

  - Получить список пользователей:
    ```bash
    yt --proxy <cluster-name> list //sys/users
    ```
  - Получить список групп:
    ```bash
    yt --proxy <cluster-name> list //sys/groups
    ```
{% endlist %}

{% note warning %}

Узлы `//sys/users` и `//sys/groups` не являются таблицами, поэтому списки пользователей и групп нельзя получить с помощью `SELECT` запроса.

{% endnote %}

Пользователи имеют тип системного объекта `user`. Группы имеют тип объекта `group`.

#### Как получить информацию о пользователе или группе

{% list tabs %}

- Через веб-интерфейс

  Перейдите на страницу пользователя или группы и нажмите значок ![](../../../../images/attrs-icon.png =20x20) справа.

- Через CLI

  Чтобы получить сведения о конкретном пользователе, используйте команду `yt --proxy <cluster-name> get //sys/users/<user-name>/@<attr-name>`. Например:

  ```
  $ yt --proxy <cluster-name> get //sys/users/vasya/@type
  "user"
  ```

  Посмотреть список всех доступных атрибутов у пользователя можно командой:

  ```bash
  $ yt --proxy <cluster-name> get //sys/users/vasya/@
  {
    "id" = "ffffffff-fffffffe-101f5-1407420e";
    "type" = "user";
    "builtin" = %true;
    ...
  }
  ```

  Аналогично, чтобы получить сведения о конкретной группе, используйте команду `yt --proxy <cluster-name> get //sys/groups/<group-name>/@<attr-name>`. Например:

  ```bash
  $ yt --proxy <cluster-name> get //sys/groups/admins/@type
  "group"
  ```

{% endlist %}
